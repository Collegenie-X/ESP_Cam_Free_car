# 🚗 ESP32-CAM 자율주행 빠른 시작 가이드

## 📋 준비사항

### 하드웨어
- ✅ ESP32-CAM (IP: 192.168.0.65)
- ✅ WiFi 연결
- ✅ 모터 드라이버 연결

### 소프트웨어
- ✅ Python 3.8 이상
- ✅ 필요한 라이브러리 설치

## 🎯 1단계: 환경 설정

### 가상환경 생성 및 활성화

```bash
cd frontend

# 가상환경 생성
python3 -m venv venv

# 가상환경 활성화 (Mac/Linux)
source venv/bin/activate

# 가상환경 활성화 (Windows)
venv\Scripts\activate
```

### 라이브러리 설치

```bash
pip install -r requirements.txt
```

## 🎯 2단계: ESP32-CAM 확인

### ESP32-CAM 연결 테스트

브라우저에서 다음 주소로 접속하여 이미지가 표시되는지 확인:

```
http://192.168.0.65/capture
```

✅ **성공**: 카메라 이미지가 표시됨  
❌ **실패**: ESP32 IP 주소 확인 또는 WiFi 연결 확인

### ESP32-CAM 상태 확인

```
http://192.168.0.65/status
```

## 🎯 3단계: 서버 시작

```bash
# frontend 디렉토리에서
python app.py
```

**예상 출력:**
```
==================================================
ESP32-CAM 자율주행차 모니터링 시스템 시작
ESP32-CAM IP: 192.168.0.65
웹 인터페이스: http://localhost:5000
==================================================
 * Running on http://0.0.0.0:5000
```

## 🎯 4단계: 자율주행 페이지 접속

브라우저에서 다음 주소로 접속:

```
http://localhost:5000/autonomous
```

## 🎯 5단계: 자율주행 시작

### 화면 구성

```
┌─────────────────────────────────────┐
│  📹 실시간 스트림                      │
│  ┌─────────────────────────────┐   │
│  │                             │   │
│  │   카메라 영상 (5fps)          │   │
│  │                             │   │
│  └─────────────────────────────┘   │
│                                     │
│  📊 히스토그램 (왼쪽/중앙/오른쪽)      │
└─────────────────────────────────────┘

┌─────────────────┐
│  🎮 제어         │
│  ▶️ 자율주행 시작 │
│  ⏹️ 자율주행 중지 │
│  🔍 단일 프레임   │
└─────────────────┘
```

### 자율주행 실행 순서

1. **페이지 로드**
   - 자동으로 카메라 연결 확인
   - 스트림 표시 시작

2. **"▶️ 자율주행 시작" 클릭**
   - 백그라운드에서 차선 추적 시작
   - ESP32로 자동 명령 전송

3. **모니터링**
   - 실시간 명령 확인 (LEFT/RIGHT/CENTER)
   - 히스토그램으로 차선 분포 확인
   - 로그에서 상세 정보 확인

4. **"⏹️ 자율주행 중지" 클릭**
   - 명령 전송 중지
   - 통계 정보 확인

## 📊 화면 설명

### 실시간 스트림
- ESP32-CAM의 `/capture`를 200ms마다 가져옴 (5fps)
- 카메라 영상을 실시간으로 표시

### 제어 패널
- **▶️ 자율주행 시작**: 차선 추적 및 자동 제어 시작
- **⏹️ 자율주행 중지**: 모터 정지 및 제어 중단
- **🔍 단일 프레임 분석**: 현재 프레임 분석 (테스트용)

### 상태 표시
- **실행 상태**: 정지 / 실행 중
- **현재 명령**: LEFT / RIGHT / CENTER / STOP
- **주행 상태**: 일반 주행 / 코너 감지 / 회전 중
- **신뢰도**: 차선 검출 신뢰도 (%)

### 통계
- **처리 프레임**: 처리한 총 프레임 수
- **명령 전송**: ESP32로 전송한 명령 수
- **오류**: 발생한 오류 수
- **경과 시간**: 자율주행 시작 후 경과 시간
- **FPS**: 초당 처리 프레임 수

### 히스토그램
- **왼쪽**: 왼쪽 영역의 차선 픽셀 수
- **중앙**: 중앙 영역의 차선 픽셀 수
- **오른쪽**: 오른쪽 영역의 차선 픽셀 수

### 시스템 로그
- 모든 이벤트가 시간과 함께 기록됨
- 성공(녹색), 오류(빨강), 정보(흰색)

## 🔧 문제 해결

### 카메라가 보이지 않는 경우

**증상**: "스트림 연결 실패" 메시지 표시

**해결 방법**:
1. ESP32-CAM 전원 확인
2. WiFi 연결 확인
3. IP 주소 확인 (192.168.0.65)
4. 브라우저에서 직접 접속 테스트:
   ```
   http://192.168.0.65/capture
   ```
5. "🔄 재시도" 버튼 클릭

### 자율주행이 시작되지 않는 경우

**증상**: 버튼 클릭 후 반응 없음

**해결 방법**:
1. 브라우저 콘솔(F12) 확인
2. 로그에서 오류 메시지 확인
3. 서버 터미널에서 로그 확인
4. ESP32 상태 확인:
   ```
   http://192.168.0.65/status
   ```

### 명령이 전송되지 않는 경우

**증상**: "현재 명령"이 업데이트되지 않음

**해결 방법**:
1. 서버 로그에서 "명령 전송" 메시지 확인
2. ESP32 `/control` 엔드포인트 테스트:
   ```
   http://192.168.0.65/control?cmd=center
   ```
3. 네트워크 연결 확인
4. ESP32 재시작

### 프레임 레이트가 낮은 경우

**증상**: 영상이 끊기거나 느림

**해결 방법**:
1. WiFi 신호 강도 확인
2. ESP32와 컴퓨터의 거리 조정
3. 다른 WiFi 채널 사용
4. FPS 설정 낮추기 (권장: 5fps)

## 💡 팁

### 최적의 성능을 위한 팁

1. **WiFi 신호**: ESP32를 라우터 근처에 배치
2. **조명**: 밝은 조명 환경에서 테스트
3. **차선**: 명확한 흰색/노란색 차선 사용
4. **속도**: 낮은 속도로 시작 (안전)

### 디버깅 팁

1. **단일 프레임 분석**: "🔍 단일 프레임 분석" 버튼으로 테스트
2. **로그 확인**: 시스템 로그에서 상세 정보 확인
3. **히스토그램 관찰**: 차선 검출이 제대로 되는지 확인
4. **브라우저 콘솔**: F12 키로 JavaScript 오류 확인

## 📝 로그 메시지 이해하기

### 정상 동작
```
✓ 카메라 연결 확인 완료
✓ 스트림 연결 성공 (/capture 폴링 방식)
✓ 자율주행 시작됨 - 명령이 ESP32로 전송됩니다
```

### 명령 전송
```
🚗 ESP32로 명령 전송: LEFT
🚗 ESP32로 명령 전송: CENTER
🚗 ESP32로 명령 전송: RIGHT
```

### 오류
```
✗ 카메라 연결 실패: Connection refused
✗ 시작 실패: ESP32에 연결할 수 없습니다
✗ 오류: Timeout error
```

## 🎓 다음 단계

### 고급 기능

1. **카메라 설정 조정**: 메인 페이지에서 밝기, 대비 등 조정
2. **속도 제어**: 모터 속도 조정
3. **AI 데모**: `/ai-demo` 페이지에서 AI 분석 확인

### 개발자 모드

서버 로그를 실시간으로 확인하려면:

```bash
# 다른 터미널에서
tail -f server.log
```

## 📞 도움말

### 추가 문서
- `AUTONOMOUS_CAPTURE_UPDATE.md`: 상세 기술 문서
- `README.md`: 프로젝트 전체 개요
- `prod.md`: 프로젝트 사양

### 문제 보고
- GitHub Issues에 문제 보고
- 로그 파일 첨부
- 스크린샷 포함

---

**즐거운 자율주행 되세요! 🚗💨**

