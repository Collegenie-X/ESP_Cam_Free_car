# ðŸ” ì‹¤ì‹œê°„ ìžìœ¨ì£¼í–‰ ë¶„ì„ ë„êµ¬ ê°€ì´ë“œ

## ðŸ“‹ ê°œìš”

`realtime_analysis.py`ëŠ” ESP32-CAMì˜ `/capture` ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ **1ì´ˆë‹¹ 3í”„ë ˆìž„**ì„ ë¶„ì„í•˜ê³ , ì‹¤ì‹œê°„ìœ¼ë¡œ ì°¨ì„  ì¸ì‹ ê²°ê³¼ë¥¼ ì‹œê°í™”í•˜ëŠ” ë„êµ¬ìž…ë‹ˆë‹¤.

---

## âœ¨ ì£¼ìš” ê¸°ëŠ¥

### 1ï¸âƒ£ ì‹¤ì‹œê°„ ë¶„ì„ (3 FPS)
- ESP32-CAMì—ì„œ 1ì´ˆë‹¹ 3ìž¥ì˜ ì‚¬ì§„ì„ ìº¡ì²˜
- ê° í”„ë ˆìž„ë§ˆë‹¤ ì°¨ì„  ì¸ì‹ ë° ì¡°í–¥ íŒë‹¨ ìˆ˜í–‰
- **ìº¡ì²˜ ì‹œê°„**, **ë¶„ì„ ì‹œê°„**, **ì „ì²´ ì‹œê°„** ì‹¤ì‹œê°„ í‘œì‹œ

### 2ï¸âƒ£ ì´ì¤‘ í™”ë©´ í‘œì‹œ
- **ì™¼ìª½**: ì›ë³¸ ì´ë¯¸ì§€
- **ì˜¤ë¥¸ìª½**: ë¶„ì„ ê²°ê³¼ (ì°¨ì„  ë§ˆìŠ¤í¬, ì¡°í–¥ ëª…ë ¹, ížˆìŠ¤í† ê·¸ëž¨)

### 3ï¸âƒ£ ë™ì  íŒŒë¼ë¯¸í„° ì¡°ì • (Trackbar)
- **White V Min**: í°ìƒ‰ ì°¨ì„  ë°ê¸° ìµœì†Œê°’ (0-255)
- **White S Max**: í°ìƒ‰ ì°¨ì„  ì±„ë„ ìµœëŒ€ê°’ (0-255)
- **Min Pixels**: ìµœì†Œ ì°¨ì„  í”½ì…€ ìˆ˜ (0-1000)

íŠ¸ëž™ë°”ë¥¼ ì¡°ì •í•˜ë©´ **ì¦‰ì‹œ** ë¶„ì„ ê²°ê³¼ì— ë°˜ì˜ë©ë‹ˆë‹¤!

### 4ï¸âƒ£ ìƒì„¸ ì •ë³´ í‘œì‹œ
- ì¡°í–¥ ëª…ë ¹ (LEFT, RIGHT, CENTER, STOP)
- ížˆìŠ¤í† ê·¸ëž¨ (ì¢Œ/ì¤‘/ìš° ì˜ì—­ë³„ í”½ì…€ ìˆ˜)
- ì‹ ë¢°ë„ (0-100%)
- ìº¡ì²˜ ì‹œê°„, ë¶„ì„ ì‹œê°„, ì „ì²´ ì²˜ë¦¬ ì‹œê°„
- í˜„ìž¬ FPS

---

## ðŸš€ ì‚¬ìš© ë°©ë²•

### 1. ì‹¤í–‰

```bash
cd /Users/kimjongphil/Documents/GitHub/ESP_Cam_Free_car/free_car

# ê°€ìƒí™˜ê²½ í™œì„±í™”
source venv/bin/activate

# ì‹¤í–‰
python realtime_analysis.py
```

ë˜ëŠ”:

```bash
./realtime_analysis.py
```

### 2. í™”ë©´ ì„¤ëª…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                          â”‚
â”‚   [ì›ë³¸ ì´ë¯¸ì§€]          [ë¶„ì„ ê²°ê³¼]                    â”‚
â”‚                                                          â”‚
â”‚   - ESP32-CAMì—ì„œ       - ì°¨ì„  ë§ˆìŠ¤í¬ ì˜¤ë²„ë ˆì´          â”‚
â”‚     ìº¡ì²˜í•œ ì›ë³¸ ì‚¬ì§„     - >>> CENTER <<< ì¡°í–¥ ëª…ë ¹     â”‚
â”‚                          - ì‹ ë¢°ë„: 85.3%                 â”‚
â”‚                          - L:450 C:820 R:320             â”‚
â”‚                          - ìº¡ì²˜: 95ms / ë¶„ì„: 12ms       â”‚
â”‚                          - FPS: 3                        â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[White V Min]  ========â—===== (200)
[White S Max]  ======â—======= (30)
[Min Pixels]   ========â—===== (200)
```

### 3. íŠ¸ëž™ë°” ì¡°ì •

#### White V Min (í°ìƒ‰ ë°ê¸° ìµœì†Œê°’)
- **ë‚®ê²Œ (100-150)**: ì–´ë‘ìš´ í™˜ê²½ì—ì„œ ì°¨ì„  ê²€ì¶œ
- **ë†’ê²Œ (200-255)**: ë°ì€ í™˜ê²½ì—ì„œ ì •í™•í•œ ê²€ì¶œ
- **ê¸°ë³¸ê°’**: 200

#### White S Max (í°ìƒ‰ ì±„ë„ ìµœëŒ€ê°’)
- **ë‚®ê²Œ (10-20)**: ìˆœìˆ˜í•œ í°ìƒ‰ë§Œ ê²€ì¶œ
- **ë†’ê²Œ (30-50)**: ì•½ê°„ ìƒ‰ì´ ìžˆëŠ” ì°¨ì„ ë„ ê²€ì¶œ
- **ê¸°ë³¸ê°’**: 30

#### Min Pixels (ìµœì†Œ í”½ì…€ ìˆ˜)
- **ë‚®ê²Œ (100-200)**: ë¯¼ê°í•˜ê²Œ ë°˜ì‘ (ì°¨ì„ ì´ ì ì–´ë„ ì¸ì‹)
- **ë†’ê²Œ (300-500)**: í™•ì‹¤í•œ ì°¨ì„ ë§Œ ì¸ì‹
- **ê¸°ë³¸ê°’**: 200

### 4. ì¢…ë£Œ

- `q` í‚¤ ëˆ„ë¥´ê¸°
- ë˜ëŠ” `Ctrl+C`

---

## ðŸ“Š ì„±ëŠ¥ ì§€í‘œ

### ì˜ˆìƒ ì„±ëŠ¥

| í•­ëª© | ê°’ |
|------|-----|
| **íƒ€ê²Ÿ FPS** | 3 FPS |
| **í‰ê·  ìº¡ì²˜ ì‹œê°„** | 80-120ms |
| **í‰ê·  ë¶„ì„ ì‹œê°„** | 10-20ms |
| **ì „ì²´ ì²˜ë¦¬ ì‹œê°„** | 90-140ms |
| **ì‹¤ì œ FPS** | 2.8-3.2 FPS |

### ì‹œê°„ ì¸¡ì •

í™”ë©´ í•˜ë‹¨ì— ì‹¤ì‹œê°„ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤:
- **ìº¡ì²˜**: ESP32ì—ì„œ ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì‹œê°„
- **ë¶„ì„**: ì°¨ì„  ì¸ì‹ ë° íŒë‹¨ ì‹œê°„
- **ì „ì²´**: ìº¡ì²˜ + ë¶„ì„ ì´ ì‹œê°„

---

## ðŸŽ¨ ì¡°í–¥ ëª…ë ¹ ìƒ‰ìƒ

- **LEFT** (ì¢ŒíšŒì „): ðŸŸ  ì£¼í™©ìƒ‰
- **RIGHT** (ìš°íšŒì „): ðŸŸ£ ìží™ìƒ‰  
- **CENTER** (ì§ì§„): ðŸŸ¢ ì´ˆë¡ìƒ‰
- **STOP** (ì •ì§€): ðŸ”´ ë¹¨ê°„ìƒ‰

---

## ðŸ”§ ì„¤ì • ë³€ê²½

### FPS ë³€ê²½

`realtime_analysis.py` íŒŒì¼ ìƒë‹¨:

```python
TARGET_FPS = 3  # ì›í•˜ëŠ” FPSë¡œ ë³€ê²½ (ì˜ˆ: 5)
```

**ê¶Œìž¥ê°’**:
- **1-2 FPS**: ë§¤ìš° ì•ˆì •ì , ëŠë¦¼
- **3 FPS**: ê· í˜• (ê¶Œìž¥) â­
- **4-5 FPS**: ë¹ ë¦„, ë¶ˆì•ˆì •í•  ìˆ˜ ìžˆìŒ

### ESP32 IP ë³€ê²½

```python
ESP32_IP = "192.168.0.65"  # ì‹¤ì œ ESP32 IPë¡œ ë³€ê²½
```

---

## ðŸ› ë¬¸ì œ í•´ê²°

### Q1. "ìº¡ì²˜ ì‹¤íŒ¨" ë©”ì‹œì§€ê°€ ê³„ì† ë‚˜ì˜µë‹ˆë‹¤

**A**: ESP32 ì—°ê²° í™•ì¸
```bash
# í„°ë¯¸ë„ì—ì„œ í…ŒìŠ¤íŠ¸
curl http://192.168.0.65/status

# ë˜ëŠ” ë¸Œë¼ìš°ì €ì—ì„œ
http://192.168.0.65/capture
```

### Q2. ì´ë¯¸ì§€ê°€ ë„ˆë¬´ ì–´ë‘¡ìŠµë‹ˆë‹¤

**A**: íŠ¸ëž™ë°” ì¡°ì •
- White V Minì„ **150-180**ìœ¼ë¡œ ë‚®ì¶”ê¸°
- ë˜ëŠ” ì•„ë‘ì´ë…¸ ì„¼ì„œ ë°ê¸° ì„¤ì • ì¦ê°€

### Q3. ì°¨ì„ ì´ ê²€ì¶œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤

**A**: 
1. White V Minì„ **150-180**ìœ¼ë¡œ ë‚®ì¶”ê¸°
2. Min Pixelsë¥¼ **100-150**ìœ¼ë¡œ ë‚®ì¶”ê¸°
3. ì£¼ë³€ ì¡°ëª… í™•ì¸

### Q4. FPSê°€ 3ë³´ë‹¤ ë‚®ìŠµë‹ˆë‹¤

**A**: 
- ESP32ì™€ì˜ ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸ (WiFi ì‹ í˜¸ ê°•ë„)
- ESP32ë¥¼ ë¼ìš°í„° ê°€ê¹Œì´ ì´ë™
- ë‹¤ë¥¸ ë„¤íŠ¸ì›Œí¬ í™œë™ ì¤„ì´ê¸°

### Q5. í™”ë©´ì´ ëŠê¹ë‹ˆë‹¤

**A**:
- ì •ìƒìž…ë‹ˆë‹¤. 3 FPSëŠ” 1ì´ˆì— 3ìž¥ì˜ ì‚¬ì§„ì´ë¯€ë¡œ ì•½ê°„ ëŠê¸¸ ìˆ˜ ìžˆìŠµë‹ˆë‹¤
- ë” ë¶€ë“œëŸ½ê²Œ í•˜ë ¤ë©´ `TARGET_FPS = 5`ë¡œ ì¦ê°€ (ë‹¨, ë¶ˆì•ˆì •í•  ìˆ˜ ìžˆìŒ)

---

## ðŸ’¡ í™œìš© íŒ

### 1. ìµœì  íŒŒë¼ë¯¸í„° ì°¾ê¸°
1. ì‹¤ì‹œê°„ ë¶„ì„ ë„êµ¬ ì‹¤í–‰
2. íŠ¸ëž™ë°”ë¥¼ ì¡°ì •í•˜ë©° ì°¨ì„ ì´ ìž˜ ê²€ì¶œë˜ëŠ” ê°’ ì°¾ê¸°
3. í•´ë‹¹ ê°’ì„ `config/settings.py`ì— ë°˜ì˜

### 2. ë‹¤ì–‘í•œ í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸
- â˜€ï¸ ë°ì€ í™˜ê²½: White V Min 200-220
- ðŸŒ™ ì–´ë‘ìš´ í™˜ê²½: White V Min 150-180
- ðŸŒ¤ï¸ ì‹¤ë‚´: White V Min 180-200

### 3. ë””ë²„ê¹…
- ì¡°í–¥ ëª…ë ¹ì´ ì´ìƒí•˜ë©´ â†’ ížˆìŠ¤í† ê·¸ëž¨ ê°’ í™•ì¸
- ì°¨ì„ ì´ ì•ˆ ë³´ì´ë©´ â†’ íŠ¸ëž™ë°” ì¡°ì •
- ì†ë„ê°€ ëŠë¦¬ë©´ â†’ í„°ë¯¸ë„ì—ì„œ ìº¡ì²˜ ì‹œê°„ í™•ì¸

---

## ðŸ“ ê¸°ìˆ  ì„¸ë¶€ì‚¬í•­

### ì°¨ì„  ê²€ì¶œ ì•Œê³ ë¦¬ì¦˜

1. **CLAHE** (Contrast Limited Adaptive Histogram Equalization)
   - ì´ë¯¸ì§€ ëŒ€ë¹„ í–¥ìƒ
   
2. **ê°€ìš°ì‹œì•ˆ ë¸”ëŸ¬**
   - ë…¸ì´ì¦ˆ ì œê±°
   
3. **ROI ì¶”ì¶œ**
   - í•˜ë‹¨ 25% ì˜ì—­ë§Œ ë¶„ì„ (ì°¨ì„ ì´ ìžˆëŠ” ì˜ì—­)
   
4. **HSV ìƒ‰ìƒ ê³µê°„ ë³€í™˜**
   - í°ìƒ‰ ë° ë¹¨ê°„ìƒ‰ ì°¨ì„  ê²€ì¶œ
   
5. **ëª¨í´ë¡œì§€ ì—°ì‚°**
   - ë…¸ì´ì¦ˆ ì œê±° (Opening, Closing)
   
6. **ížˆìŠ¤í† ê·¸ëž¨ ë¶„ì„**
   - 3ë“±ë¶„í•˜ì—¬ ì¢Œ/ì¤‘/ìš° í”½ì…€ ìˆ˜ ê³„ì‚°
   
7. **ì¡°í–¥ íŒë‹¨**
   - ë°ë“œì¡´ ë° íŽ¸í–¥ ë¹„ìœ¨ ê¸°ë°˜ íŒë‹¨

### HTTP ì—°ê²° ìµœì í™”

- **ì„¸ì…˜ ìž¬ì‚¬ìš©**: `requests.Session()` ì‚¬ìš©
- **Keep-Alive**: ì—°ê²° ìœ ì§€ë¡œ ì˜¤ë²„í—¤ë“œ ê°ì†Œ
- **ìŠ¤íŠ¸ë¦¬ë° ëª¨ë“œ**: ì²­í¬ ë‹¨ìœ„ ë°ì´í„° ìˆ˜ì‹ 
- **íƒ€ìž„ì•„ì›ƒ**: 2ì´ˆ (ë¹ ë¥¸ ì‹¤íŒ¨)

---

## ðŸŽ¯ ë‹¤ìŒ ë‹¨ê³„

1. âœ… ì‹¤ì‹œê°„ ë¶„ì„ìœ¼ë¡œ ìµœì  íŒŒë¼ë¯¸í„° ì°¾ê¸°
2. âœ… `config/settings.py`ì— íŒŒë¼ë¯¸í„° ë°˜ì˜
3. âœ… `main.py`ë¡œ ì‹¤ì œ ìžìœ¨ì£¼í–‰ ì‹¤í–‰
4. âœ… íŠ¸ëž™ í…ŒìŠ¤íŠ¸ ë° ì¡°ì •

---

**ìž‘ì„±ì¼**: 2025-10-24  
**ë²„ì „**: v1.0

