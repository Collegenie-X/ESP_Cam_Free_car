# ðŸš— ESP32-CAM ìžìœ¨ì£¼í–‰ ì‹œìŠ¤í…œ ì™„ì „ ê°€ì´ë“œ

## ðŸ“‹ ëª©ì°¨
1. [ì‹œìŠ¤í…œ ê°œìš”](#ì‹œìŠ¤í…œ-ê°œìš”)
2. [í•µì‹¬ ê¸°ëŠ¥](#í•µì‹¬-ê¸°ëŠ¥)
3. [ë¹ ë¥¸ ì‹œìž‘](#ë¹ ë¥¸-ì‹œìž‘)
4. [ì„¸ë¶€ ì„¤ëª…](#ì„¸ë¶€-ì„¤ëª…)
5. [íŒŒë¼ë¯¸í„° ì¡°ì •](#íŒŒë¼ë¯¸í„°-ì¡°ì •)
6. [ë¬¸ì œ í•´ê²°](#ë¬¸ì œ-í•´ê²°)

---

## ì‹œìŠ¤í…œ ê°œìš”

ESP32-CAMì˜ ì €í’ˆì§ˆ ì´ë¯¸ì§€ì—ì„œë„ ì•ˆì •ì ìœ¼ë¡œ ìž‘ë™í•˜ëŠ” **í•˜ì´ë¸Œë¦¬ë“œ ìžìœ¨ì£¼í–‰ ì‹œìŠ¤í…œ**ìž…ë‹ˆë‹¤.

### ì£¼ìš” íŠ¹ì§•
- âœ… **ê°•ë ¥í•œ ì´ë¯¸ì§€ ì „ì²˜ë¦¬** (í–‡ë¹› ë°˜ì‚¬ ì œê±°!)
- âœ… **ë‹¤ì¸µ ì„¸ê·¸ë©˜í…Œì´ì…˜** (ë„ë¡œ, ë„ë¡œì„ , ìž¥ì• ë¬¼)
- âœ… **í•˜ì´ë¸Œë¦¬ë“œ ë°©í–¥ ê²°ì •** (ìƒí™©ë³„ ìµœì  ì•Œê³ ë¦¬ì¦˜)
- âœ… **90ë„ ë„ë¡œì„  ëŒ€ì‘** (íš¡ë‹¨ë³´ë„, Tìž êµì°¨ë¡œ)
- âœ… **ì‹¤ì‹œê°„ ëª¨í„° ì œì–´** (GET ë°©ì‹ í†µì‹ )

---

## í•µì‹¬ ê¸°ëŠ¥

### 1. ì´ë¯¸ì§€ ì „ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸

```
ì›ë³¸ ì´ë¯¸ì§€ (320x240, ì–´ë‘¡ê³  ë…¸ì´ì¦ˆ ë§ŽìŒ)
    â†“
CLAHE (ëŒ€ë¹„ í–¥ìƒ) â†’ ì–´ë‘ìš´ ë¶€ë¶„ ë°ê²Œ, ë°ì€ ë¶€ë¶„ ì–´ë‘¡ê²Œ
    â†“
í–‡ë¹› ë°˜ì‚¬ ì œê±° â˜… â†’ ê³¼í¬í™” ì˜ì—­ ì£¼ë³€ í”½ì…€ë¡œ ë³´ê°„
    â†“
ë…¸ì´ì¦ˆ ì œê±° â†’ Non-local Means Denoising
    â†“
ìƒ¤í”„ë‹ â†’ ë„ë¡œì„  ì—£ì§€ ê°•ì¡°
    â†“
ì„ ëª…í•œ ì´ë¯¸ì§€ â†’ ì„¸ê·¸ë©˜í…Œì´ì…˜
```

### 2. 3ì§„ ì„¸ê·¸ë©˜í…Œì´ì…˜

| ê°’ | ì˜ë¯¸ | ìƒ‰ìƒ | ê°€ì¤‘ì¹˜ |
|----|------|------|--------|
| 0 | ê²€ì •ìƒ‰ ë„ë¡œ | ì–´ë‘ìš´ íšŒìƒ‰ | x0 |
| 1 | ê¸°íƒ€ ìƒ‰ìƒ (ìž¥ì• ë¬¼) | ë…¸ëž€ìƒ‰ | x1 |
| 2 | ë„ë¡œì„  (í°ìƒ‰/íšŒìƒ‰/ë¹¨ê°„ìƒ‰) | ë¹¨ê°„ìƒ‰ | x5 â­ |

### 3. ë‹¤ì¸µ ROI ê°€ì¤‘ì¹˜

í™”ë©´ì„ ìƒ/ì¤‘/í•˜ë¡œ ë‚˜ëˆ„ì–´ ê°€ê¹Œìš´ ê³³ì— ë” í° ê°€ì¤‘ì¹˜:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ìƒë‹¨ 40% (x1)     â”‚ ë©€ê³  ë…¸ì´ì¦ˆ ë§ŽìŒ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ì¤‘ë‹¨ 30% (x2)     â”‚ ì¤‘ê°„ ê±°ë¦¬
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   í•˜ë‹¨ 30% (x3)     â”‚ ê°€ê¹ê³  ì •í™• â­
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. í•˜ì´ë¸Œë¦¬ë“œ ë°©í–¥ ê²°ì •

```python
if 90ë„_ë„ë¡œì„ _ê°ì§€:
    ë”_ë„“ì€_ìª½ìœ¼ë¡œ_íšŒì „()
elif ì°¨ì„ _ëª…í™• (>5%):
    ì°¨ì„ _ìœ„ì¹˜_ê¸°ë°˜_ë°©í–¥()  # ê³¡ì„  ëŒ€ì‘ ìš°ìˆ˜
elif ìž¥ì• ë¬¼_ë§ŽìŒ (>30%):
    ìž¥ì• ë¬¼_íšŒí”¼_ëª¨ë“œ()  # ë¹ˆ ê³µê°„ ì°¾ê¸°
elif ì°¨ì„ _ìžˆìŒ (>2%):
    ê°€ì¤‘_ížˆìŠ¤í† ê·¸ëž¨_ë°©í–¥()  # ê¸°ë³¸ ëª¨ë“œ
else:
    ì´ì „_ëª…ë ¹_ìœ ì§€() or ì •ì§€()
```

---

## ë¹ ë¥¸ ì‹œìž‘

### 1. í™˜ê²½ ì„¤ì •

```bash
cd /Users/kimjongphil/Documents/GitHub/ESP_Cam_Free_car/free_car
source venv/bin/activate
```

### 2. Config í™•ì¸ ë° ìˆ˜ì •

`realtime_analysis/config.py` íŒŒì¼ì—ì„œ ESP32 IP ì£¼ì†Œ í™•ì¸:

```python
ESP32_IP = "192.168.0.65"  # ì‹¤ì œ IPë¡œ ë³€ê²½
```

### 3. ìžìœ¨ì£¼í–‰ ì‹¤í–‰

```bash
python3 autonomous_drive.py
```

### 4. í‚¤ë³´ë“œ ì»¨íŠ¸ë¡¤

| í‚¤ | ê¸°ëŠ¥ |
|----|------|
| **A** | ìžìœ¨ì£¼í–‰ ëª¨ë“œ ON/OFF |
| **O** | ìž¥ì• ë¬¼ ëª¨ë“œ ON/OFF |
| **L** | LED ON/OFF |
| **Q** ë˜ëŠ” ESC | ì¢…ë£Œ |

---

## ì„¸ë¶€ ì„¤ëª…

### ì´ë¯¸ì§€ ì „ì²˜ë¦¬ ì˜µì…˜

`config.py`ì—ì„œ ì¡°ì • ê°€ëŠ¥:

```python
# ì „ì²˜ë¦¬ í™œì„±í™”/ë¹„í™œì„±í™”
ENABLE_IMAGE_ENHANCEMENT = True  # Falseë¡œ í•˜ë©´ ì›ë³¸ ì‚¬ìš©

# ê° ë‹¨ê³„ ê°œë³„ ì œì–´
BRIGHTNESS_BOOST = 20        # ë°ê¸° ì¶”ê°€ (0-100)
CONTRAST_BOOST = 1.3         # ëŒ€ë¹„ ë°°ìœ¨ (1.0-2.0)
ENABLE_CLAHE = True          # ì ì‘í˜• ížˆìŠ¤í† ê·¸ëž¨ í‰í™œí™”
ENABLE_SHARPENING = True     # ì—£ì§€ ìƒ¤í”„ë‹
ENABLE_DENOISING = True      # ë…¸ì´ì¦ˆ ì œê±°
```

### ì„¸ê·¸ë©˜í…Œì´ì…˜ ìž„ê³„ê°’ ì¡°ì •

```python
# ê²€ì •ìƒ‰ ë„ë¡œ ë²”ìœ„
BLACK_V_MIN = 0      # ìµœì†Œ ë°ê¸°
BLACK_V_MAX = 60     # ìµœëŒ€ ë°ê¸°
BLACK_S_MAX = 80     # ìµœëŒ€ ì±„ë„

# íšŒìƒ‰ ë„ë¡œì„  ë²”ìœ„
GRAY_V_MIN = 50      # ìµœì†Œ ë°ê¸°
GRAY_V_MAX = 150     # ìµœëŒ€ ë°ê¸°
GRAY_S_MAX = 50      # ìµœëŒ€ ì±„ë„

# ë¹¨ê°„ìƒ‰ ì°¨ì„  ë²”ìœ„
RED_H_LOW_MIN = 0    # ë¹¨ê°• ë²”ìœ„1 ì‹œìž‘
RED_H_LOW_MAX = 15   # ë¹¨ê°• ë²”ìœ„1 ë
RED_H_HIGH_MIN = 155 # ë¹¨ê°• ë²”ìœ„2 ì‹œìž‘
RED_H_HIGH_MAX = 180 # ë¹¨ê°• ë²”ìœ„2 ë
RED_S_MIN = 80       # ìµœì†Œ ì±„ë„
RED_V_MIN = 80       # ìµœì†Œ ë°ê¸°
```

**ì¡°ì • ê°€ì´ë“œ:**
- ê²€ì •ìƒ‰ì´ ë„ˆë¬´ ë§Žì´ ê°ì§€ë˜ë©´: `BLACK_V_MAX` ê°ì†Œ
- ë„ë¡œì„ ì´ ê°ì§€ ì•ˆë˜ë©´: `GRAY_V_MAX` ì¦ê°€, `GRAY_S_MAX` ì¦ê°€
- ë¹¨ê°„ìƒ‰ ì°¨ì„  ê°ì§€ ê°•í™”: `RED_S_MIN`, `RED_V_MIN` ê°ì†Œ

### ìžìœ¨ì£¼í–‰ íŒŒë¼ë¯¸í„°

```python
# ë°©í–¥ ê²°ì • ìž„ê³„ê°’
STEERING_CENTER_THRESHOLD = 500   # abs(left-right) > ì´ ê°’ì¼ ë•Œë§Œ íšŒì „
STEERING_MIN_CONFIDENCE = 0.3     # ìµœì†Œ ì‹ ë¢°ë„ (ë‚®ìœ¼ë©´ ëª…ë ¹ ì•ˆ ë³´ëƒ„)

# 90ë„ ë„ë¡œì„  ê°ì§€
HORIZONTAL_LINE_THRESHOLD = 0.7   # ìˆ˜í‰ì„  ë¹„ìœ¨
HORIZONTAL_LINE_MIN_LENGTH = 50   # ìµœì†Œ ì„  ê¸¸ì´ (í”½ì…€)
```

---

## íŒŒë¼ë¯¸í„° ì¡°ì •

### íŠ¸ëž™ë°” (ì‹¤ì‹œê°„ ì¡°ì • ê°€ëŠ¥)

ì‹¤í–‰ ì¤‘ í™”ë©´ ìƒë‹¨ íŠ¸ëž™ë°”ë¡œ ì¡°ì •:

1. **White V Min** (0-255)
   - í°ìƒ‰ ì°¨ì„  ê°ì§€ ìµœì†Œ ë°ê¸°
   - ë†’ì¼ìˆ˜ë¡ ë” ë°ì€ ê²ƒë§Œ ê°ì§€
   - ì¶”ì²œ: 180-220

2. **White S Max** (0-100)
   - í°ìƒ‰ ì°¨ì„  ìµœëŒ€ ì±„ë„
   - ë‚®ì„ìˆ˜ë¡ ìˆœìˆ˜í•œ í°ìƒ‰ë§Œ
   - ì¶”ì²œ: 20-40

3. **Min Pixels** (0-1000)
   - ìµœì†Œ í”½ì…€ ìˆ˜
   - ì´ë³´ë‹¤ ì ìœ¼ë©´ ì •ì§€
   - ì¶”ì²œ: 100-300

4. **Brightness** (-2 ~ +2)
   - ESP32 ì¹´ë©”ë¼ ë°ê¸°
   - ì–´ë‘ìš°ë©´ +1 ë˜ëŠ” +2

5. **Contrast** (-2 ~ +2)
   - ESP32 ì¹´ë©”ë¼ ëŒ€ë¹„
   - ì¶”ì²œ: 0 ë˜ëŠ” +1

6. **Saturation** (-2 ~ +2)
   - ESP32 ì¹´ë©”ë¼ ì±„ë„
   - ì¶”ì²œ: 0

---

## ë¬¸ì œ í•´ê²°

### 1. ì°¨ì„  ê°ì§€ê°€ ì•ˆë¨

**ì¦ìƒ:** ížˆìŠ¤í† ê·¸ëž¨ì´ ëª¨ë‘ 0 ë˜ëŠ” ë§¤ìš° ìž‘ìŒ

**í•´ê²°:**
1. `White V Min` ë‚®ì¶”ê¸° (200 â†’ 180 â†’ 150)
2. `White S Max` ë†’ì´ê¸° (30 â†’ 50 â†’ 70)
3. `config.py`ì—ì„œ `GRAY_V_MAX` ì¦ê°€ (150 â†’ 180)
4. ESP32 ì¹´ë©”ë¼ `Brightness` ì¦ê°€

### 2. í–‡ë¹› ë°˜ì‚¬ë¡œ ì˜¤ìž‘ë™

**ì¦ìƒ:** ë°ì€ ë¶€ë¶„ì„ ì°¨ì„ ìœ¼ë¡œ ì˜¤ì¸

**í•´ê²°:**
- ìžë™ìœ¼ë¡œ ì²˜ë¦¬ë¨ (inpainting)
- íš¨ê³¼ê°€ ì•½í•˜ë©´ `image_processor.py`ì˜ `_suppress_specular_highlights` í•¨ìˆ˜ì—ì„œ:
  ```python
  reflection_mask = ((v > 245) & (s < 15))
  # â†’ v ê°’ì„ ë‚®ì¶”ê¸° (245 â†’ 240 â†’ 235)
  ```

### 3. ë°©í–¥ì´ ë„ˆë¬´ ìžì£¼ ë°”ë€œ

**ì¦ìƒ:** ë–¨ë¦¼, ë¶ˆì•ˆì •

**í•´ê²°:**
1. `STEERING_CENTER_THRESHOLD` ì¦ê°€ (500 â†’ 800 â†’ 1000)
2. `autonomous_driver.py`ì˜ `buffer_size` ì¦ê°€ (3 â†’ 5 â†’ 7)

### 4. ê³¡ì„  ë„ë¡œì—ì„œ ì´íƒˆ

**ì¦ìƒ:** ì§ì„ ì€ ê´œì°®ì§€ë§Œ ê³¡ì„ ì—ì„œ ì‹¤íŒ¨

**í•´ê²°:**
- ìžë™ìœ¼ë¡œ ì°¨ì„  ìœ„ì¹˜ ê¸°ë°˜ ëª¨ë“œë¡œ ì „í™˜ë¨
- ì°¨ì„ ì´ ì¶©ë¶„ížˆ ê°ì§€ë˜ëŠ”ì§€ í™•ì¸ (íŠ¸ëž™ë°” ì¡°ì •)

### 5. ëª¨í„° ì œì–´ ì•ˆë¨

**ì¦ìƒ:** í™”ë©´ì€ ë³´ì´ì§€ë§Œ ì°¨ê°€ ì•ˆ ì›€ì§ìž„

**ì²´í¬ë¦¬ìŠ¤íŠ¸:**
1. ESP32 IP ì£¼ì†Œ í™•ì¸:
   ```python
   # config.py
   ESP32_IP = "192.168.0.65"  # ì‹¤ì œ IP
   ```

2. ëª¨í„° ì œì–´ URL í™•ì¸:
   ```python
   MOTOR_CONTROL_URL = f"http://{ESP32_IP}/control"
   ```

3. ìžìœ¨ì£¼í–‰ ëª¨ë“œ ON í™•ì¸:
   - í™”ë©´ í•˜ë‹¨ì— `[AUTO]` í‘œì‹œë˜ì–´ì•¼ í•¨
   - 'A' í‚¤ë¥¼ ëˆŒëŸ¬ í™œì„±í™”

4. í„°ë¯¸ë„ ë¡œê·¸ í™•ì¸:
   ```
   âœ… Motor: LEFT (conf: 0.85)
   âœ… Motor: CENTER (conf: 0.92)
   ```

5. ìˆ˜ë™ìœ¼ë¡œ í…ŒìŠ¤íŠ¸:
   ```bash
   curl "http://192.168.0.65/control?cmd=left"
   curl "http://192.168.0.65/control?cmd=center"
   curl "http://192.168.0.65/control?cmd=right"
   curl "http://192.168.0.65/control?cmd=stop"
   ```

---

## ì„±ëŠ¥ ìµœì í™”

### ì†ë„ í–¥ìƒ

**ëª©í‘œ FPS ì¡°ì •:**
```python
# config.py
TARGET_FPS = 3  # ì•ˆì •ì„± ìš°ì„ 
# ë˜ëŠ”
TARGET_FPS = 5  # ì†ë„ ìš°ì„  (ë…¸ì´ì¦ˆ ì œê±° ë¹„í™œì„±í™” ì¶”ì²œ)
```

**ì „ì²˜ë¦¬ ë‹¨ê³„ ë¹„í™œì„±í™”:**
```python
ENABLE_DENOISING = False  # ê°€ìž¥ ëŠë¦° ë‹¨ê³„
ENABLE_SHARPENING = False
```

### ì •í™•ë„ í–¥ìƒ

**ì „ì²˜ë¦¬ ê°•í™”:**
```python
BRIGHTNESS_BOOST = 30  # ë” ë°ê²Œ
CONTRAST_BOOST = 1.5   # ëŒ€ë¹„ ê°•í™”
```

**ê°€ì¤‘ì¹˜ ì¦ê°€:**
```python
# lane_detector.py ìˆ˜ì •
LANE_WEIGHT = 10  # 5 â†’ 10
```

---

## ðŸ“Š ì‹¤í–‰ ê²°ê³¼ ì˜ˆì‹œ

```
ðŸš— ESP32-CAM Autonomous Driving System
======================================================================
ESP32-CAM IP: 192.168.0.65

âœ… All modules initialized

ðŸŽ® Controls:
  - Press 'A' to toggle AUTONOMOUS mode
  - Press 'O' to toggle OBSTACLE mode
  - Press 'L' to toggle LED
  - Press 'Q' or ESC to quit

ðŸš€ Starting autonomous driving... (Mode: ON)

âœ… Frame 30: Capture OK (41ms)
âœ… Motor: CENTER (conf: 0.92)
âœ… Motor: LEFT (conf: 0.78)
âœ… Motor: LEFT (conf: 0.85)
âœ… Motor: CENTER (conf: 0.94)
```

---

## ðŸ”¬ ì•Œê³ ë¦¬ì¦˜ ìƒì„¸

### ížˆìŠ¤í† ê·¸ëž¨ ê³„ì‚° ì˜ˆì‹œ

```
í™”ë©´ì„ ì¢Œ/ì¤‘/ìš°ë¡œ 3ë“±ë¶„:

Left    â”‚ Center  â”‚ Right
â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€
        â”‚         â”‚
   O    â”‚    L    â”‚   O
   O    â”‚    L    â”‚   O
   O    â”‚    L    â”‚
â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€

O = ìž¥ì• ë¬¼ (1ì )
L = ë„ë¡œì„  (5ì )

ê³„ì‚° (ë‹¤ì¸µ ROI ì ìš©):
í•˜ë‹¨ 30%: (1*3 + 1*3 + 1*3) + (5*3) = 24ì 
ì¤‘ë‹¨ 30%: (1*2 + 1*2 + 1*2) + (5*2) = 16ì 
ìƒë‹¨ 40%: (1 + 1 + 1) + (5) = 8ì 

Left = 7ì 
Center = 38ì  â­
Right = 7ì 

â†’ ê²°ì •: CENTER
```

---

## ðŸ“ íŒŒì¼ êµ¬ì¡°

```
free_car/
â”œâ”€â”€ autonomous_drive.py          # ë©”ì¸ ì‹¤í–‰ íŒŒì¼ â­
â”œâ”€â”€ realtime_analysis/
â”‚   â”œâ”€â”€ config.py                # ëª¨ë“  ì„¤ì •
â”‚   â”œâ”€â”€ capture_client.py        # ESP32 í†µì‹ 
â”‚   â”œâ”€â”€ image_processor.py       # ì „ì²˜ë¦¬ + ì„¸ê·¸ë©˜í…Œì´ì…˜
â”‚   â”œâ”€â”€ lane_detector.py         # ížˆìŠ¤í† ê·¸ëž¨ + ë°©í–¥ íŒë‹¨
â”‚   â”œâ”€â”€ autonomous_driver.py     # í•˜ì´ë¸Œë¦¬ë“œ ìžìœ¨ì£¼í–‰
â”‚   â””â”€â”€ ui_components.py         # UI í‘œì‹œ
â””â”€â”€ AUTONOMOUS_DRIVING_GUIDE.md  # ì´ íŒŒì¼
```

---

## ðŸš€ ë‹¤ìŒ ë‹¨ê³„

### ê°œì„  ì•„ì´ë””ì–´
1. **AI ëª¨ë¸ í†µí•©** (MobileNet-SSD)
2. **PID ì œì–´** (ë¶€ë“œëŸ¬ìš´ ì¡°í–¥)
3. **ìž¥ì• ë¬¼ ê±°ë¦¬ ì¸¡ì •** (ì´ˆìŒíŒŒ ì„¼ì„œ)
4. **ì£¼í–‰ ê²½ë¡œ ê¸°ë¡** (ë¡œê·¸ ë¶„ì„)

---

## ðŸ“ž ë¬¸ì˜ ë° í”¼ë“œë°±

ë¬¸ì œê°€ ë°œìƒí•˜ê±°ë‚˜ ê°œì„  ì•„ì´ë””ì–´ê°€ ìžˆìœ¼ì‹œë©´ ì´ìŠˆë¡œ ë‚¨ê²¨ì£¼ì„¸ìš”!

---

**Made with â¤ï¸ for ESP32-CAM Autonomous Driving**


